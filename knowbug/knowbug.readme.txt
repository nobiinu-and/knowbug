
	knowbug (ver: 1.0β7)
	
＠概要
	上大が拡張した HSP デバッグ・ウィンドウです。
	
	変数データ表示機能を拡張しており、標準では表示できない、多次元配列の二次元目
	以降や、モジュール変数のメンバまで見れます。
	
＠導入方法
	まず、HSPのフォルダ(*)にある「hsp3debug.dll」というファイルの名前を変更し、
	別のもの (hsp3debug_default.dll など) にします。
	
	次に、同梱されている「hsp3debug_knowbug.dll」の名前を「hsp3debug.dll」に変え、
	先ほどの(HSPの)フォルダにコピーします。
	また、「WrapCall.hpi」も同じフォルダにコピーします。
	
	同梱されている「WrapCall.as」を common フォルダに入れ、common フォルダ内の
	「userdef.as」というファイル (なければ作成してください) に、次の行を追加：
		#include "WrapCall.as"
	@ WrapCall は +dynamic 以下の情報を取得するのに使いますが、なくても動きます。
	
	* HSPのフォルダ
		HSPがインストールされているフォルダで、「common」フォルダの1つ上です。
		通常は、「C:\Program Files\hsp32」となります。数字は変わるかもしれません。
	
＠除去方法
	「＠導入方法」と逆の操作をします。
	
	knowbug (ファイル名 hsp3debug.dll) を削除し、バックアップしておいた、元々の
	hsp3debug.dll を、元に戻します。
	
	「knowbug.ini」「WrapCall.hpi」「WrapCall.as」は不要なので削除します。
	
	レジストリは使用しません。
	
＠機能詳細
＊「全般」タブ
	
	内容は本家とだいたい同じです (ランタイムから供給されるもの)。
	
	win32gui版では、カレント・ポジション (pos) とカレント色 (color) も表示します。
	
＊「変数」タブ
	
	本家版とはレイアウトが異なり、画面を上下に二分して、上にツリービューが、下に
	エディットボックスがあります。後者は、本家版と同じ働きです。
	
	ツリーには、すべての静的変数の名前を、モジュールごとに分類して並べています。
	この項目を選択すると、下のボックスに、変数の内容 (変数データ) が表示されます。
	
	変数データは、ツリー形式の文字列で表されます。基本的には通常と同じですが、
	配列やモジュール実体は、特別な方法で表示します。凡例は以下の通り：
		
		(単体: 一次元一要素)
		要素名 = 値
		
		(一次元配列)
		要素名:
			.vartype = 型名
			.length  = 配列要素
			要素リスト
		
		(多次元配列)
		要素名:
			.vartype = 型名
			.format  = (要素数(1), ...) (全要素数 in total)
			要素リスト
		
		(インスタンス)
		要素名:
			[@clone]		// クローン要素にのみ表示される
			.modcls = クラス名
			要素リスト
		
	なお、配列の四次元目は、諸事情により表示できません。
	
	＃＃
	
	また、ルートに位置する「+sysvar」ノードの直下には、システム変数が存在します。
	以下は特殊な形式で表示されます：
	
		(cnt)
		#n = ...
		#m = ...
		
		一番上にあるのが、最外周ループの cnt です。#n の n は looplev となります。
		また、(out of loop) は「repeat の外なので cnt が存在しない」を意味します。
		
		(params)
		iparam = ...
		wparam = ...
		lparam = ...
		
		似たようなシステム変数なので、これらは仮想システム変数 params として、3つ
		同時に表示されます。
		
		(notebuf)
		[notebuf] (PVal*[APTR])
		...
		
		notepad 命令群に設定されたバッファを表示します。
		@ 変数名を表示するのは難しいです。
		
	＃＃
	
	同じくルートに位置する「+dynamic」ノードの直下には、実行中に呼び出されている
	ユーザ定義命令・関数のリストが存在します。
	
	「次行」「停止」ボタンを利用したステップ実行の途中に見ることができます。
	
	＃＃
	
	なお、本家版にあるチェックボックス (ソート, モジュール, 配列, メモリダンプ)
	は、すべて on の状態です。
	
・変数情報
	変数名: 変数の名前です。モジュールの中にある変数も、完全な名前で表示します。
	変数型: 変数の型です。
	配列 (x, y, z):
		配列の形を表します。x, y, z はそれぞれ、1次元目、2次元目、3次元目の
		要素数です。存在しない次元の要素数は 0 で扱います。
		配列になっていない変数は (1, 0, 0) です (要素数1の1次元配列なのですが)。
	モード:
		dup, dupptr などを受けた、いわゆるクローン変数のとき「クローン(clone)」
		と表示します。
		通常は「実体(instance)」となっています。
		@ 基本的には、「無効(disable)」が表示されることはありません。
	アドレス:
		2つの8桁の16進数で表します。
		前者は、変数の実体データがあるメモリのアドレスで、
		後者は、変数のマスターデータがあるメモリのアドレスです。
		@ PVal::pt, PVal::master のこと。
	サイズ:
		"using X in Y [byte]" の形式で表します。
		Y は実体データが「確保」しているメモリサイズ [byte] で、
		X はそのうち、使用している部分のサイズです。
		
＊「ログ」タブ
	* 自動更新チェックボックス
		これを外すと、logmes 命令が実行されても、一時的にログが更新されません。
		@ 更新はかなり時間の掛かる処理です。たくさんの出力がある場合は、これを
			off にした方が高速になります。
	* 呼出履歴チェックボックス
		これを付けると、ユーザ定義命令・関数の呼び出しと終了が logmes されます。
	* 等角フォントを用いています ( 開発者の好み )。
		@ "ＭＳ ゴシック", 9[pt]
	
＠開発環境
	OS : Windows XP sp3 HomeEdition
	IDE: Visual C++ 2010 Express Edition
	Lng: C++
	
＠動作環境
	HSP: 3.3β 以降
	OS : Windows XP sp3
	
	@ これら以外では、動作を確認していません。サポートできない可能性も高いのでご了承ください。
	@ Windows のバージョンの違いにより、問題が起きる可能性があります。
	
＠ソースコード
	ぐっちゃぐちゃです。ご自由にお使いください。
	
＠著作権
	knowbug は、公式のデバッガ hsp3debug.dll に、上大が手を加えたものです。
	
	本ソフトの半分程度は、OpenHSP にあるコード、およびリソースを使用しています。
		(/trunk/tools/win32/hsp3debug/*)
	
	その著作権表示は、以下の通りです：
		Copyright (C) 1997-2011, Onion Software/onitama.
		All rights reserved.
	また、Lisense フォルダの中身も参考にしてください。
	
＠参照
	・プログラ広場
		[http://prograpark.ninja-web.net/]
		上大とかーみのサイトです。バグ報告、意見、感想、要望などは、ここの掲示板
		までお願いします。また、最新版は、ここの「たまり場」にあります。
		
	・HSPTV!
		[http://hsp.tv/]
		HSPの公式サイトです。
		
	・OpenHSP
		[http://dev.onionsoft.net/trac/]
		プロジェクト OpenHSP のリポジトリがあるサイトです。
		HSPはここで開発されています。
		
--------------------------------------------------------------------------------
＠メモ
	すごく個人的なメモです。
	
・Wishlist
	・ツリーのモジュール項目をクリックしたとき、ddwTree のように表示する。
		@ 不要説
	・array[str]型を、要素ごとにメモリダンプしたい。
		@ ごちゃごちゃしすぎて見づらいわ。
	・ginfo に対応。
		@ アクティブなウィンドウの ginfo を、すべて表示 (CVarinfoTreeを拡張)。
		@ めんどくｓ
	・変数内にある文字列の縦断検索。
		@ 検索窓が設置できないとかなんとか。
	・「ログ消去ボタン」？
	
・挫折
	・CVarinfoText と CVarinfoTree の統合。
		@ref: 2010 02/07
	・comobj, variant の拡張表示。
		そもそも中身がわからないｗ
	・イミディエイト実行→無理ぽ。
		実行時データをコンパイラに教える方法が無い (作るのはめんどくさい)。
	・ステップ実行→無理ぽ。
		よくわからないが、実行中に dbg_set(HSPDEBUG_STOP) を使っても止まらないみたい。
	
・その他
	・32bit 環境でのみ動作確認 (新版)。
	・デバッグ文字列の生成を HspVarProc に任せると、ランタイム側がデバッグ時に使用できるという利点がある。
	・なぜか Debug でビルドすると、Release でビルドした clhsp の vector の内容を読み取れない。
	・Release::Build Event::Post Build
		Command Line:
			copy $(TargetPath) ..\..\..\hsp3\win32\release\
			copy $(TargetPath) ..\..\..\hsp3\win32gui\release\
		
＠履歴
2011.07.21 (Thu)
	・WrapCall の仕様変更に対応した。
		ユーザ定義コマンドの呼び出し開始・終了を、ウィンドウメッセージではなく関数ポインタの呼び出しで
		通知するようになった。
	・リリース (ver: 1.0β7)
	
2011.07.18 (Mon)
	・var_vector.hpi の拡張表示に対応した。
	
2011.06.23 (Thu)
	・仮想システム変数 notebuf を追加した。notepad 命令群に設定されたバッファを表示する。
	・システム変数の値を表す文字列を CVarinfoTree で作成するようにした。
	
2011.06/22 (Wed)
	・変数情報部分の書式を変更した (http://twitpic.com/5f3ye7)。
	・変数データやログの、タブ文字幅を指定できるようにした。
		@ [Interface] tabwidth = 4 (default)
	・変数データ文字列の字下げ(indent)を "    " ではなく "\t" でするようにした。
	・システム変数 iparam, wparam, lparam を params として1つのページで表示するようにした。
	
2011.06/21 (Tue)
	・var_multi.hpi の拡張表示に対応した。
	・静的でない変数が、要素数1でも単体変数(Scalar)ではなく、配列(Vector)として扱われていた不具合を修正した。
	
2011 06/13 (Mon)
	・呼び出し終了時に削除するツリーノードが、最後のではなく2番目のノードになっていたバグを修正した。
		for 文で TreeView_GetNextSibling() を複数回使おうとしたが、実際は初期化にしか書いていなかったという酷いミス。
	・再リリース (ver: 1.0β5)
	
2011 03/29 (Tue)
	・WrapCall.hpi との連携に対応。
		+Dynamic ノードで、呼び出されたユーザ定義命令・関数の引数の値を表示できるようにした。
		呼び出し履歴を logmes 出来るようにした。
	・リリース (ver: 1.0β5)
	
2010 02/07 (Sun), 〃/08 (Mon)
	・Visitor パターンを利用した方法に変更しようとしたが、無理だった。
		@ 残骸 → new_knowbug フォルダ
		
2010 02/06 (Sat)
	・「@a@s」と「@b@s」など、領域内に領域があるとき、それらの関係を逆に解釈して
		しまうバグを修正した。
		@ex: 同じ例で：
			-@
				-@a
					-@s
				-@b
					-@s
			正しくは：
			-@				// @
				-@s			// @s
					-@a		// @a@s
					-@b		// @b@s
	
2010 01/13 (Wed)
	・カスタムドローするかどうかを、ini ファイルで設定できるようにした。
		@ [ColorType]::bCustomDraw キーが真ならカスタムドローする。
	・全般タブのリストに要素を追加するコードを、若干すっきりさせた。
	・配列の aptr が 0x8000 以上のとき、符号が負に変わって、メモリ違反を起こし、
		異常終了してしまうバグを、hsp モードでのみ修正した。
		@ PVal::offset が signed short 扱いになっていたため。
	・hsp モードでは、ちゃんと、 hsp 本来のヘッダを用いるようにした。
		@ ただし、clhsp での定義が複数の場所に散らばってしまう。
		@ 配列の四次元目を表示できるようになったが、需要がなさそうなので変更なし。
	・hsp モードで、thismod を、引数に指定された要素だけ表示するようにした。
	・リリース (ver: 1.0β4)
		
2010 01/11 (Mon)
	・再コンパイル。
	
2010 01/02 (Sat)
	・システム変数 err を表示するようにした。
	・Vector要素 VecElem を表示する際に、実体要素なら *、参照要素なら & を、
		要素名 ( 通常は [n] ) の後に付けるようにした。
	・VecElemが参照要素で、aptr != 0 のとき、その要素の値のみを varScalar として
		取り出すようにした。
	
2009 12/19 (Sat)
	・Vectorの仕様変更に対応し、再ビルドした。
	・変数データツリーが300以上の深さになると、エラーで再帰を終了するようにした。
	・変数データツリーが長すぎると ( 0x5000 bytes 以上 )、途中で切るようにした。
	
2009 12/18 (Fri)
	・iniファイルを、ランタイムと同じフォルダから探すようにした。
		@ スクリプトエディタがカレントディレクトリを変更してしまうため、
			カレントから探すと発見できない可能性が高い。
	・カスタムドローで、NM_PREPAINT などの戻り値を、SetWindowLong() を用いて返す
		ようにした。
		@ return では返すことができないため、NM_PREPAINT が発生しなかった。
	・変数ツリーで、型ごとに色を変えるようにした。
	・(ver: 1.0β3)
	
2009 12/17 (Thu)
	・ツリービューをカスタムドローするようにしようとした。
	・iniファイルからの読み込みができるようにした。
	
2009 12/16 (Wed)
	・cntを表示するに際し、配列のように、トップレベルではないループの cnt 値も
		表示するようにした。
		「#n」は looplev が n である位置の cnt を表す。最上段がトップ。
	・「マルチスレッド Dll (/MD)」から「マルチスレッド (/MT)」に変更した。
		@ Windows XP sp2 以前の環境でも動くようになった。
	・リリース (ver: 1.0β2)
	
2009 12/15 (Tue)
	・Kernel32.dll に EncodePointer() がない環境でエラーが起きるVS2010のバグに
		対応するため、ビルドは VC++2008Ex で行うようにした。
	・リリース (ver: 1.0β1)
	・バッファサイズは、メモリダンプ時に表示するようにした。
	・システム変数を、ツリーの「$sysvar」ノードに持たせるように、追加した。
	・ツリーのトップレベルのノードはすべて開いた状態にするようにした。
	
2009 12/14 (Mon)
	・log-Editboxが更新されても、選択状態を維持するようにした。
	・log-Editboxの自動更新を止めるために、自動更新の有無をチェックボックスで
		管理し、自動更新が無効化された状態で TabLogAdd された文字列は、一旦、
		別のバッファに書きためるようにした。
	・hsp互換モードでは、配列の添字括弧に [] ではなく () を用いるようにした。
	・初リリース (ver: 1.0β0)
		HSPTV! 掲示板で宣伝した：http://hsp.tv/play/pforum.php?mode=pastwch&num=29264
	
2009 12/13 (Sun)
	・Compile-Switchで、hsp向けのバージョンとして作成できるようにした。
		@ clhsp 限定の機能は、clhsp マクロがないと制御される。
	・多次元配列の全要素が表示できるようにした。ただし、諸事情により3次元に限る。
	・nullmod を表示するときに、NULL参照エラーが発生していたバグを修正した。
	・hsp互換モードで、struct型の内容 (FlexValue) を拡張表示するようにした。
	・バージョン情報を埋め込むようにした。
	・delmod された後の FlexValue の ptr が NULL になっていない可能性があるのを
		考慮して、type が FLEXVAL_TYPE_NONE でないことも条件にした。
		@ 無効ポインタの参照でエラーが起きていた。
	・変数データテキストが 0x2000 バイトより大きければ、malloc で必要なだけ確保
		して対応するようにした。
	
2009 12/12 (Sat)
	・変数の内容のツリー形式文字列を、関数ではなく CVarinfoTree クラスが生成する
		ようにした。
	・マクロ USE_DEFAULT_ARG がないために、STRUCTPRM の大きさがビルド時と違って
		いたバグを修正した。
	・modinst のメンバを拡張表示するようにした。
	・変数の内容は CVarinfoText クラスを用いて生成するようにした。
	・メモリダンプの表示形式を変更した。
		@ 1行に 16 バイト分表示するなど、ddw に似せた。
	・変数データテキストを、項目をＷクリックしたり、リターンキー ( [Enter] ) を
		押したりしても更新するようにした。
	・logmes されても変数ツリーを構築し直さないようにした。
	
2009 12/10 (Thu)
	・vector ツリーで、「=」の左辺に「変数名[a][b]...[n]」ではなく「[n]」とだけ
		表示するようにした。
		また、.vartype で型名を表示するようにした。
	・vector が空の時の表記を変更した。
	
2009 12/09 (Wed)
	・HSP3DEBUG::dbg_toString() を追加した。
	・変数の内容 (varinf) を、knowbug が処理して表示するようにした。
		@ つまり、HSP3DEBUG::dbg_getvarinf() を呼ばないようになった。
	・vectorをツリー形式の文字列で表示するようにした。
	
2009 12/07 (Mon)
	・別フォルダに移動し、knowbug に改名した。
	・静的変数リストを、木構造の CVarTree クラスで管理するようにした。
	・「変数」タブのチェックボックスを削除し、「配列」「静的ローカル」
		「メモリダンプ」などを常に行うようにした。
	・変数リストをツリービューで表示するようにした。
	
2009 12/06 (Sun)
	・初弄り。
	・EditControl のフォントを「MS UI Gothic」から「ＭＳ ゴシック」に変更した。
	・タブのページを、限界まで広く使うようにした。
	・初期状態で、「配列」「静的ローカル (旧 : モジュール)」「メモリダンプ」の
		チェックをついた状態にした。
	・「ソート」ボタンを削除し、常にソートするようにした。
	・変数リストをリストボックスに取得するに際し、一旦 CVarnameList クラスに変数
		名を追加し、それの反復子を用いるようにした。
		@ 属するモジュールごとに変数を分別するため。
	・静的変数リストは、始めに1回だけ取得するようにした。
		@ 途中で変わるわけがないため。
	・変数がないときに、無効な iterator を脱参照してしまっていたバグを修整した。
	
＠更新履歴
2011 06/13 (Mon)
	・呼び出し終了時に削除するツリーノードが、最後のではなく2番目のノードになっていたバグを修正した。
	・再リリース (ver: 1.0β5)
	
2011 03/30 (Wed)
	・WrapCall.hpi との連携に対応。
		+Dynamic ノードで、呼び出されたユーザ定義命令・関数の引数の値を表示できるようにした。
		呼び出し履歴を logmes 出来るようにした。
	・リリース (ver: 1.0β5)
		しかしバグ発覚のため撤回。
	
2010 01/13 (Wed)
	・設定ファイル knowbug.ini を利用するようにした。
	・ツリービューのカスタムドローにより、変数ツリーの変数名を、型によって色分け
		するようにした。
		@ 設定は knowbug.ini から読み取る。既定値 COLORREF(0, 0, 0)。
		@ bCustomDraw が偽値のときは、色分け処理を行わない。既定値 false。
	・変数データ文字列の最大長を設定できるようにした。既定値 8195 (0x2000 - 1)。
		@ この数値に大きな意味はない。
	・システム変数 err を表示するようにした。
	・要素数が 32768 (0x8000) 以上の配列変数を表示するとき、knowbug が異常終了
		するバグを修正した。
	・thismod を、指定された要素だけ表示するようにした。
	・リリース (ver: 1.0β4)
	
2009 12/16 (Wed)
	・「マルチスレッド (/MT)」に変更して再ビルド。
	・システム変数を表示する機能を追加。
	・リリース (ver: 1.0β2)。
	
2009 12/15 (Tue)
	・VC++Exを用いて再ビルド。
	・リリース (ver: 1.0β1)
	
2009 12/14 (Mon)
	・初リリース (ver: 1.0β0)。HSPTV! 掲示板で宣伝。
	
2009 12/06 (Sun)
	・弄り始める (ver: 0.0)。
